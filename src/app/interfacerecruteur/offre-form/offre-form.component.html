
<div class="page-wrapper">
  <app-header></app-header>
  <div class="page-body-wrapper">
    <app-sidebar [sidebarOpen]="sidebarOpen" (toggleSidebar)="toggleSidebar()"></app-sidebar>
    <div class="page-body">
      <div class="card">
        <div class="card-header">
          <h4>Liste des Offres d'Emploi</h4>
        </div>
        <div class="card-body">
<form [formGroup]="offreForm" (ngSubmit)="onSubmit()">
  <div class="card">
    <div class="card-header">Informations principales *</div>
    <div class="card-body">
      <div class="mb-3">
        <label class="form-label">Titre de l'offre *</label>
        <input type="text" formControlName="titreOffre" class="form-control" [class.is-invalid]="submitted && offreForm.get('titreOffre')?.invalid">
        <div class="text-danger" *ngIf="submitted && offreForm.get('titreOffre')?.errors?.['required']">Titre requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Description *</label>
        <textarea formControlName="descriptionOffre" class="form-control" [class.is-invalid]="submitted && offreForm.get('descriptionOffre')?.invalid"></textarea>
        <div class="text-danger" *ngIf="submitted && offreForm.get('descriptionOffre')?.errors?.['required']">Description requise</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Spécialité *</label>
        <input type="text" formControlName="specialite" class="form-control" [class.is-invalid]="submitted && offreForm.get('specialite')?.invalid">
        <div class="text-danger" *ngIf="submitted && offreForm.get('specialite')?.errors?.['required']">Spécialité requise</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Date de publication</label>
        <input type="date" formControlName="datePublication" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Date d'expiration *</label>
        <input type="date" formControlName="dateExpiration" class="form-control" [class.is-invalid]="submitted && offreForm.get('dateExpiration')?.invalid">
        <div class="text-danger" *ngIf="submitted && offreForm.get('dateExpiration')?.errors?.['required']">Date requise</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Niveau d'expérience requis *</label>
        <select formControlName="niveauExperienceRequis" class="form-control" [class.is-invalid]="submitted && offreForm.get('niveauExperienceRequis')?.invalid">
          <option value="">Sélectionner un niveau</option>
          <option *ngFor="let niveau of niveauxRequis" [value]="niveau">{{ niveau }}</option>
        </select>
        <div class="text-danger" *ngIf="submitted && offreForm.get('niveauExperienceRequis')?.errors?.['required']">Niveau requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Salaire minimum *</label>
        <input type="number" formControlName="salaireMin" class="form-control" [class.is-invalid]="submitted && offreForm.get('salaireMin')?.invalid">
        <div class="text-danger" *ngIf="submitted && offreForm.get('salaireMin')?.errors?.['required']">Salaire min requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Salaire maximum *</label>
        <input type="number" formControlName="salaireMax" class="form-control" [class.is-invalid]="submitted && offreForm.get('salaireMax')?.invalid">
        <div class="text-danger" *ngIf="submitted && offreForm.get('salaireMax')?.errors?.['required']">Salaire max requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Type de contrat *</label>
        <select formControlName="typeContrat" class="form-control" [class.is-invalid]="submitted && offreForm.get('typeContrat')?.invalid">
          <option value="">Sélectionner un type</option>
          <option *ngFor="let type of typeContrats" [value]="type">{{ type }}</option>
        </select>
        <div class="text-danger" *ngIf="submitted && offreForm.get('typeContrat')?.errors?.['required']">Contrat requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Statut *</label>
        <select formControlName="statut" class="form-control" [class.is-invalid]="submitted && offreForm.get('statut')?.invalid">
          <option value="">Sélectionner un statut</option>
          <option *ngFor="let statut of statuts" [value]="statut">{{ statut }}</option>
        </select>
        <div class="text-danger" *ngIf="submitted && offreForm.get('statut')?.errors?.['required']">Statut requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Mode de travail *</label>
        <select formControlName="modeTravail" class="form-control" [class.is-invalid]="submitted && offreForm.get('modeTravail')?.invalid">
          <option value="">Sélectionner un mode</option>
          <option *ngFor="let mode of modesTravail" [value]="mode">{{ mode }}</option>
        </select>
        <div class="text-danger" *ngIf="submitted && offreForm.get('modeTravail')?.errors?.['required']">Mode requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Filiale *</label>
        <select formControlName="idFiliale" class="form-control" [class.is-invalid]="submitted && offreForm.get('idFiliale')?.invalid">
          <option value="">Sélectionner une filiale</option>
          <option *ngFor="let filiale of filiales" [value]="filiale.idFiliale">{{ filiale.nom }}</option>
        </select>
        <div class="text-danger" *ngIf="submitted && offreForm.get('idFiliale')?.errors?.['required']">Filiale requise</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Département *</label>
        <select formControlName="idDepartement" class="form-control" [class.is-invalid]="submitted && offreForm.get('idDepartement')?.invalid">
          <option value="">Sélectionner un département</option>
          <option *ngFor="let dept of departements" [value]="dept.idDepartement">{{ dept.nom }}</option>
        </select>
        <div class="text-danger" *ngIf="submitted && offreForm.get('idDepartement')?.errors?.['required']">Département requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Recruteur *</label>
        <select formControlName="idRecruteur" class="form-control" [class.is-invalid]="submitted && offreForm.get('idRecruteur')?.invalid">
          <option value="">Sélectionner un recruteur</option>
          <option *ngFor="let recruteur of recruteurs" [value]="recruteur.id">{{ recruteur.fullName }}</option>
        </select>
        <div class="text-danger" *ngIf="submitted && offreForm.get('idRecruteur')?.errors?.['required']">Recruteur requis</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Avantages</label>
        <textarea formControlName="avantages" class="form-control"></textarea>
      </div>
      <div class="form-check mb-3">
        <input type="checkbox" formControlName="estActif" class="form-check-input">
        <label class="form-check-label">Offre active</label>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Diplômes requis *</div>
    <div class="card-body">
      <div formArrayName="diplomeIds">
        <div *ngFor="let diplome of diplomeIds.controls; let i=index" [formGroupName]="i" class="mb-3">
          <div class="row">
            <div class="col">
              <label class="form-label">Nom du diplôme *</label>
              <input type="text" formControlName="nomDiplome" class="form-control" [class.is-invalid]="submitted && diplomeIds.at(i).get('nomDiplome')?.invalid">
              <div class="text-danger" *ngIf="submitted && diplomeIds.at(i).get('nomDiplome')?.errors?.['required']">Nom requis</div>
            </div>
            <div class="col">
              <label class="form-label">Domaine *</label>
              <input type="text" formControlName="domaine" class="form-control" [class.is-invalid]="submitted && diplomeIds.at(i).get('domaine')?.invalid">
              <div class="text-danger" *ngIf="submitted && diplomeIds.at(i).get('domaine')?.errors?.['required']">Domaine requis</div>
            </div>
            <div class="col">
              <label class="form-label">Niveau *</label>
              <input type="text" formControlName="niveau" class="form-control" [class.is-invalid]="submitted && diplomeIds.at(i).get('niveau')?.invalid">
              <div class="text-danger" *ngIf="submitted && diplomeIds.at(i).get('niveau')?.errors?.['required']">Niveau requis</div>
            </div>
          </div>
          <button type="button" (click)="removeDiplome(i)" class="btn btn-outline-danger mt-2">Supprimer</button>
        </div>
      </div>
      <button type="button" (click)="addDiplome()" class="btn btn-primary mb-3">Ajouter un diplôme</button>
      <div class="text-danger" *ngIf="submitted && diplomeIds.length === 0">Au moins un diplôme est requis</div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Compétences requises *</div>
    <div class="card-body">
      <div formArrayName="offreCompetences">
        <div *ngFor="let competence of offreCompetences.controls; let i=index" [formGroupName]="i" class="mb-3">
          <div class="row">
            <div class="col">
              <label class="form-label">Compétence *</label>
              <div class="input-group">
                <select formControlName="idCompetence" class="form-control" [class.is-invalid]="submitted && offreCompetences.at(i).get('idCompetence')?.invalid" [disabled]="offreCompetences.at(i).get('isNew')?.value">
                  <option value="">Sélectionner une compétence</option>
                  <option *ngFor="let c of competences" [value]="c.id">{{ c.nom }} ({{ c.estTechnique ? 'Technique' : c.estSoftSkill ? 'Soft Skill' : '' }})</option>
                </select>
                <input type="text" formControlName="newCompetenceName" class="form-control" [class.is-invalid]="submitted && offreCompetences.at(i).get('newCompetenceName')?.invalid" *ngIf="offreCompetences.at(i).get('isNew')?.value" placeholder="Nom de la nouvelle compétence">
              </div>
              <div class="form-check mt-2">
                <input type="checkbox" formControlName="isNew" id="isNew_{{i}}" class="form-check-input" (change)="onNewCompetenceChange(i)">
                <label class="form-check-label" for="isNew_{{i}}">Nouvelle compétence</label>
              </div>
              <div class="text-danger" *ngIf="submitted && offreCompetences.at(i).get('idCompetence')?.errors?.['required'] && !offreCompetences.at(i).get('isNew')?.value">Compétence requise</div>
              <div class="text-danger" *ngIf="submitted && offreCompetences.at(i).get('newCompetenceName')?.errors?.['required'] && offreCompetences.at(i).get('isNew')?.value">Nom de la nouvelle compétence requis</div>
              <div *ngIf="offreCompetences.at(i).get('isNew')?.value" class="mt-2">
                <label class="form-label">Description</label>
                <input type="text" formControlName="description" class="form-control" [class.is-invalid]="submitted && offreCompetences.at(i).get('description')?.invalid">
                <div class="text-danger" *ngIf="submitted && offreCompetences.at(i).get('description')?.errors?.['required'] && offreCompetences.at(i).get('isNew')?.value">Description requise</div>
                <div class="form-check mt-2">
                  <input type="checkbox" formControlName="estTechnique" id="estTechnique_{{i}}" class="form-check-input">
                  <label class="form-check-label" for="estTechnique_{{i}}">Technique</label>
                </div>
                <div class="form-check mt-2">
                  <input type="checkbox" formControlName="estSoftSkill" id="estSoftSkill_{{i}}" class="form-check-input">
                  <label class="form-check-label" for="estSoftSkill_{{i}}">Soft Skill</label>
                </div>
              </div>
            </div>
            <div class="col">
              <label class="form-label">Niveau requis *</label>
              <select formControlName="niveauRequis" class="form-control" [class.is-invalid]="submitted && offreCompetences.at(i).get('niveauRequis')?.invalid">
                <option value="">Sélectionner un niveau</option>
                <option *ngFor="let niveau of niveauxRequis" [value]="niveau">{{ niveau }}</option>
              </select>
              <div class="text-danger" *ngIf="submitted && offreCompetences.at(i).get('niveauRequis')?.errors?.['required']">Niveau requis</div>
            </div>
          </div>
          <button type="button" (click)="removeCompetence(i)" class="btn btn-outline-danger mt-2">Supprimer</button>
        </div>
      </div>
      <button type="button" (click)="addCompetence()" class="btn btn-primary mb-3">Ajouter une compétence</button>
      <div class="text-danger" *ngIf="submitted && offreCompetences.length === 0">Au moins une compétence est requise</div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Postes à pourvoir *</div>
    <div class="card-body">
      <button type="button" (click)="addPoste()" class="btn btn-primary mb-3">Ajouter un poste</button>
      <div formArrayName="postes">
        <div *ngFor="let poste of postes.controls; let i=index" [formGroupName]="i" class="mb-3">
          <div class="row">
            <div class="col">
              <label class="form-label">Titre *</label>
              <input type="text" formControlName="titrePoste" class="form-control" [class.is-invalid]="submitted && postes.at(i).get('titrePoste')?.invalid">
              <div class="text-danger" *ngIf="submitted && postes.at(i).get('titrePoste')?.errors?.['required']">Titre requis</div>
            </div>
            <div class="col">
              <label class="form-label">Nombre *</label>
              <input type="number" formControlName="nombrePostes" class="form-control" [class.is-invalid]="submitted && postes.at(i).get('nombrePostes')?.invalid">
              <div class="text-danger" *ngIf="submitted && postes.at(i).get('nombrePostes')?.errors?.['required']">Nombre requis</div>
            </div>
            <div class="col">
              <label class="form-label">Niveau hiérarchique *</label>
              <input type="text" formControlName="niveauHierarchique" class="form-control" [class.is-invalid]="submitted && postes.at(i).get('niveauHierarchique')?.invalid">
              <div class="text-danger" *ngIf="submitted && postes.at(i).get('niveauHierarchique')?.errors?.['required']">Niveau requis</div>
            </div>
            <div class="col">
              <label class="form-label">Description *</label>
              <textarea formControlName="description" class="form-control" [class.is-invalid]="submitted && postes.at(i).get('description')?.invalid"></textarea>
              <div class="text-danger" *ngIf="submitted && postes.at(i).get('description')?.errors?.['required']">Description requise</div>
            </div>
          </div>
          <button type="button" (click)="removePoste(i)" class="btn btn-outline-danger mt-2">Supprimer</button>
        </div>
      </div>
      <div class="text-danger" *ngIf="submitted && postes.length === 0">Au moins un poste est requis</div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Missions principales *</div>
    <div class="card-body">
      <button type="button" (click)="addMission()" class="btn btn-primary mb-3">Ajouter une mission</button>
      <div formArrayName="offreMissions">
        <div *ngFor="let mission of offreMissions.controls; let i=index" [formGroupName]="i" class="mb-3">
          <div class="row">
            <div class="col">
              <label class="form-label">Description de la mission *</label>
              <textarea formControlName="descriptionMission" class="form-control" [class.is-invalid]="submitted && offreMissions.at(i).get('descriptionMission')?.invalid"></textarea>
              <div class="text-danger" *ngIf="submitted && offreMissions.at(i).get('descriptionMission')?.errors?.['required']">Mission requise</div>
            </div>
            <div class="col">
              <label class="form-label">Priorité</label>
              <input type="text" formControlName="priorite" class="form-control">
            </div>
          </div>
          <button type="button" (click)="removeMission(i)" class="btn btn-outline-danger mt-2">Supprimer</button>
        </div>
      </div>
      <div class="text-danger" *ngIf="submitted && offreMissions.length === 0">Au moins une mission est requise</div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Langues requises *</div>
    <div class="card-body">
      <button type="button" (click)="addLangue()" class="btn btn-primary mb-3">Ajouter une langue</button>
      <div formArrayName="offreLangues">
        <div *ngFor="let langue of offreLangues.controls; let i=index" [formGroupName]="i" class="mb-3">
          <div class="row">
            <div class="col">
              <label class="form-label">Langue *</label>
              <select formControlName="langue" class="form-control" [class.is-invalid]="submitted && offreLangues.at(i).get('langue')?.invalid">
                <option value="">Sélectionner une langue</option>
                <option *ngFor="let l of languesDisponibles" [value]="l">{{ l }}</option>
              </select>
              <div class="text-danger" *ngIf="submitted && offreLangues.at(i).get('langue')?.errors?.['required']">Langue requise</div>
            </div>
            <div class="col">
              <label class="form-label">Niveau *</label>
              <select formControlName="niveauRequis" class="form-control" [class.is-invalid]="submitted && offreLangues.at(i).get('niveauRequis')?.invalid">
                <option value="">Sélectionner un niveau</option>
                <option *ngFor="let niveau of niveauxRequis" [value]="niveau">{{ niveau }}</option>
              </select>
              <div class="text-danger" *ngIf="submitted && offreLangues.at(i).get('niveauRequis')?.errors?.['required']">Niveau requis</div>
            </div>
          </div>
          <button type="button" (click)="removeLangue(i)" class="btn btn-outline-danger mt-2">Supprimer</button>
        </div>
      </div>
      <div class="text-danger" *ngIf="submitted && offreLangues.length === 0">Au moins une langue est requise</div>
    </div>
  </div>

  <div class="d-flex justify-content-end">
    <button type="button" (click)="cancel()" class="btn btn-secondary me-2">Annuler</button>
    <button type="submit" class="btn btn-primary">{{ isEditMode ? 'Mettre à jour' : 'Créer' }}</button>
  </div>
</form>
        </div>
<app-footer></app-footer>
</div>