<!-- profile-candidate.component.html -->
<header>
  <div class="job-listing-header">
    <div class="container">
      <div class="logo">
        <a routerLink="/"><img src="../../../assets/User/img/logo/poulina.jpg" alt="Poulina Group Holding"></a>
      </div>
      <nav class="main-nav">
        <ul>
          <li><a routerLink="/">Accueil</a></li>
          <li><a routerLink="/job-list">Offres d'emploi</a></li>
          <li><a routerLink="/about">À propos</a></li>
          <li><a routerLink="/contact">Contact</a></li>
        </ul>
      </nav>
      <div class="auth-buttons">
        <a (click)="onLogout()" class="btn-signup">Déconnexion</a>
      </div>
    </div>
  </div>
</header>

<main class="candidate-profile">
  <div class="profile-container">
    <!-- Sidebar du profil -->
    <aside class="profile-sidebar">
      <!-- Photo de profil avec upload -->
      <label for="profile-photo-upload" class="photo-upload-label">
        <img [src]="profile?.photoUrl || 'https://via.placeholder.com/150'" 
             alt="Photo de profil" class="profile-picture">
        <div class="upload-overlay">
          <i class="fas fa-camera"></i>
        </div>
      </label>
      <input type="file" id="profile-photo-upload" accept="image/*" 
             (change)="onFileSelected($event)" style="display: none;">

      <h1 class="profile-name">{{ getFullName() }}</h1>
      <p class="profile-title" *ngIf="profile?.filiale">
        <!-- {{ profile.filiale?.nom }} -->
      </p>
      
      <div class="progress-container">
        <div class="progress-label">
          <span>Profil complété</span>
          <span>{{ progress }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progress"></div>
        </div>
      </div>
      
      <ul class="profile-nav">
        <li><a href="/profile-update" class="active"><i class="fas fa-user"></i> Mon Profil</a></li>
        <li><a href="#"><i class="fas fa-file-alt"></i> Candidatures</a></li>
        <li><a href="#"><i class="fas fa-question-circle"></i> Quiz & Évaluations</a></li>
        <li><a href="#"><i class="fas fa-comments"></i> Entretiens</a></li>
      </ul>
      
      <div class="skills-section">
        <h3>
          <i class="fas fa-check-circle"></i> Compétences validées
        </h3>
        <div class="skill-percentage">
          {{ skillValidation }}%
        </div>
      </div>
    </aside>
    
    <!-- Contenu principal du profil -->
    <div class="profile-content">
      <div *ngIf="loading" class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i> Chargement du profil...
      </div>

      <div *ngIf="error" class="error-message">
        <i class="fas fa-exclamation-triangle"></i> {{ error }}
      </div>

      <div *ngIf="profile && !loading">
        <!-- Section Informations personnelles -->
        <section class="section">
          <h2 class="section-title">
            <i class="fas fa-info-circle"></i> Informations personnelles
          </h2>
          
          <div class="personal-info-grid">
            <div class="info-item">
              <div class="info-label">Nom complet</div>
              <div class="info-value">{{ getFullName() }}</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Téléphone</div>
              <div class="info-value">{{ profile.phoneNumber }}</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Email</div>
              <div class="info-value">{{ profile.email }}</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Localisation</div>
              <div class="info-value">{{ getLocation() }}</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Adresse</div>
              <div class="info-value">{{ profile.adresse }}</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Date de naissance</div>
              <div class="info-value">
                {{ profile.dateNaissance | date: 'dd/MM/yyyy' }}
              </div>
            </div>
          </div>
        </section>
        
        <!-- Section Expérience professionnelle -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-briefcase"></i> Expérience professionnelle
            </h2>
            <button class="btn-add" (click)="openExperienceForm()">
              <i class="fas fa-plus"></i> Ajouter
            </button>
          </div>
          
          <div *ngFor="let exp of experiences" class="experience-item">
            <div class="item-header">
              <h3 class="job-title">{{ exp.poste }}</h3>
              <div class="item-actions">
                <button (click)="openExperienceForm(exp)" class="btn-edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button (click)="deleteExperience(exp.id)" class="btn-delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="company-name">
              <i class="fas fa-building"></i> {{ exp.nomEntreprise }}
            </div>
            <div class="job-period">
              {{ formatDate(exp.dateDebut) }} - {{ exp.dateFin ? formatDate(exp.dateFin) : 'Présent' }}
            </div>
            <p *ngIf="exp.description" class="job-description">{{ exp.description }}</p>
            <div *ngIf="exp.competenceAcquise" class="job-skills">
              <span class="skill-tag">{{ exp.competenceAcquise }}</span>
            </div>
          </div>

          <div *ngIf="experiences.length === 0" class="no-data">
            {{ experiencesError || 'Aucune expérience professionnelle enregistrée' }}
          </div>
        </section>
        
        <!-- Section Formation -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-graduation-cap"></i> Formation
            </h2>
            <button class="btn-add" (click)="openDiplomaForm()">
              <i class="fas fa-plus"></i> Ajouter
            </button>
          </div>
          
          <div *ngFor="let diploma of diplomas" class="education-item">
            <div class="item-header">
              <h3 class="degree">{{ diploma.nomDiplome }}</h3>
              <div class="item-actions">
                <button (click)="openDiplomaForm(diploma)" class="btn-edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button (click)="deleteDiploma(diploma.id)" class="btn-delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="institution">{{ diploma.institution }}</div>
            <div class="education-period">
              {{ formatDate(diploma.dateObtention) }}
            </div>
            <p *ngIf="diploma.specialite" class="education-description">
              Spécialité: {{ diploma.specialite }}
            </p>
          </div>

          <div *ngIf="diplomas.length === 0" class="no-data">
            {{ diplomasError || 'Aucun diplôme enregistré' }}
          </div>
        </section>

        <!-- Section Certifications -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-award"></i> Certifications
            </h2>
            <button class="btn-add" (click)="openCertificateForm()">
              <i class="fas fa-plus"></i> Ajouter
            </button>
          </div>
          
          <div *ngFor="let cert of certificates" class="education-item">
            <div class="item-header">
              <h3 class="degree">{{ cert.nom }}</h3>
              <div class="item-actions">
                <button (click)="openCertificateForm(cert)" class="btn-edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button (click)="deleteCertificate(cert.id)" class="btn-delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="institution">{{ cert.organisme }}</div>
            <div class="education-period">
              Obtenu le: {{ formatDate(cert.dateObtention) }}
              <span *ngIf="cert.dateExpiration">
                | Expire le: {{ formatDate(cert.dateExpiration) }}
              </span>
            </div>
          </div>

          <div *ngIf="certificates.length === 0" class="no-data">
            {{ certificatesError || 'Aucune certification enregistrée' }}
          </div>
        </section>
      </div>
    </div>
  </div>
</main>

<footer class="job-listing-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-logo">
        <img src="../../../assets/User/img/logo/poulina.jpg" alt="Poulina Group Holding">
        <p>Construire ensemble l'avenir professionnel.</p>
      </div>
      
      <div class="footer-links">
        <div class="footer-column">
          <h4>Entreprise</h4>
          <a href="#">À propos</a>
          <a href="#">Carrières</a>
          <a href="#">Filiales</a>
          <a href="#">Actualités</a>
        </div>
        
        <div class="footer-column">
          <h4>Ressources</h4>
          <a href="#">FAQ</a>
          <a href="#">Conditions d'utilisation</a>
          <a href="#">Politique de confidentialité</a>
          <a href="#">Contact</a>
        </div>
        
        <div class="footer-column">
          <h4>Contact</h4>
          <p><i class="fas fa-map-marker-alt"></i> Tunisie, 1082</p>
          <p><i class="fas fa-phone"></i> +216 70 010 000</p>
          <p><i class="fas fa-envelope"></i> contactpoulina.com</p>
        </div>
      </div>
    </div>
    
    <div class="copyright">
      <p>&copy; {{ currentYear }} Poulina Group Holding. Tous droits réservés.</p>
    </div>
  </div>
</footer>

<!-- Modals pour CRUD -->
<div *ngIf="showExperienceModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h2>{{ editingItem ? 'Modifier expérience' : 'Ajouter une expérience' }}</h2>
      <button (click)="closeModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveExperience()">
        <div class="form-group">
          <label for="poste">Poste *</label>
          <input type="text" id="poste" formControlName="poste">
        </div>
        
        <div class="form-group">
          <label for="nomEntreprise">Entreprise *</label>
          <input type="text" id="nomEntreprise" formControlName="nomEntreprise">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="dateDebut">Date de début *</label>
            <input type="date" id="dateDebut" formControlName="dateDebut">
          </div>
          
          <div class="form-group">
            <label for="dateFin">Date de fin</label>
            <input type="date" id="dateFin" formControlName="dateFin">
          </div>
        </div>
        
        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" formControlName="description"></textarea>
        </div>
        
        <div class="form-group">
          <label for="competenceAcquise">Compétences acquises</label>
          <input type="text" id="competenceAcquise" formControlName="competenceAcquise">
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">Annuler</button>
          <button type="submit" class="btn-save">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div *ngIf="showDiplomaModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h2>{{ editingItem ? 'Modifier diplôme' : 'Ajouter un diplôme' }}</h2>
      <button (click)="closeModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveDiploma()">
        <div class="form-group">
          <label for="nomDiplome">Diplôme *</label>
          <input type="text" id="nomDiplome" formControlName="nomDiplome">
        </div>
        
        <div class="form-group">
          <label for="institution">Établissement *</label>
          <input type="text" id="institution" formControlName="institution">
        </div>
        
        <div class="form-group">
          <label for="dateObtention">Date d'obtention *</label>
          <input type="date" id="dateObtention" formControlName="dateObtention">
        </div>
        
        <div class="form-group">
          <label for="specialite">Spécialité</label>
          <input type="text" id="specialite" formControlName="specialite">
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">Annuler</button>
          <button type="submit" class="btn-save">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div *ngIf="showCertificateModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h2>{{ editingItem ? 'Modifier certificat' : 'Ajouter un certificat' }}</h2>
      <button (click)="closeModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveCertificate()">
        <div class="form-group">
          <label for="nom">Nom du certificat *</label>
          <input type="text" id="nom" formControlName="nom">
        </div>
        
        <div class="form-group">
          <label for="organisme">Organisme émetteur *</label>
          <input type="text" id="organisme" formControlName="organisme">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="dateObtention">Date d'obtention *</label>
            <input type="date" id="dateObtention" formControlName="dateObtention">
          </div>
          
          <div class="form-group">
            <label for="dateExpiration">Date d'expiration</label>
            <input type="date" id="dateExpiration" formControlName="dateExpiration">
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">Annuler</button>
          <button type="submit" class="btn-save">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>
</div>